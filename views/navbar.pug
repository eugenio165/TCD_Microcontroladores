doctype html
html(lang='en')
    head
        meta(charset='utf-8')
        title TCD - Antônio Eugênio
        meta(name='viewport', content='width=device-width, initial-scale=1.0')
        meta(name='description', content='')
        meta(name='author', content='')
        link(rel='stylesheet', href='https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css', integrity='sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm', crossorigin='anonymous')
        link(href='/css/main.css', rel='stylesheet')
        style(type='text/css').

            body {
                background-image: url('/assets/bg-iot.jpg');
                background-repeat: repeat;
                background-attachment: fixed;
                height: max-content;
                min-height: 100vh;
            }

            .text-white {
                margin-right: 15px;
                color: white;
            }
        script(src='/socket.io/socket.io.js')
    body
        .container
            nav.navbar.navbar-expand-sm.navbar-dark.bg-dark
                a.navbar-brand(href='/') TCD - Antônio Eugênio
                ul.navbar-nav.mr-auto
                    li(class= (route == 'principal') ? 'active' : '').nav-item
                        a(href='/').nav-link Principal
                    li(class= (route == 'admin') ? 'active' : '').nav-item
                        a(href='/admin').nav-link Admin
                span.text-white Status da conexão:
                #statusbtn.btn.btn-primary Conectando
            block content
            
    script.
        var SERVER_URL = '#{serverurl}';

        window.onload = function () {
            var socket = io(SERVER_URL, {reconnectionAttempts: 6, reconnectionDelayMax: 3000});
            var status  = document.getElementById('statusbtn');
            socket.on('connect', (data) => {
                status.classList.remove('btn-primary','btn-danger', 'btn-info', 'btn-success');
                status.classList.add('btn-success');
            });
            socket.on('reconnecting', (data) => {
                status.classList.remove('btn-primary','btn-danger', 'btn-info', 'btn-success');
                status.classList.add('btn-info');
            });
            socket.on('reconnect_failed', () => {
                status.classList.remove('btn-primary','btn-danger', 'btn-info', 'btn-success');
                status.classList.add('btn-danger');
            });
        //- socket.on('led status', (status) => {
        //-     var LEDS = status.map(s => {
        //-         return {state: s, querying = false};
        //-     });
        //-     console.log(status);
        //- });
        }
